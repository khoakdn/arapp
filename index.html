<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Model Viewer</title>
    
    <!-- Include A-Frame and AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-ar@1.7.2/aframe-ar.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">

    <!-- Create the A-Frame AR Scene -->
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">

        <!-- Camera setup for AR -->
        <a-camera id="camera" position="0 0 0" look-controls="pointerLockEnabled: true;"></a-camera>

        <!-- 3D Model to Display (Replace with Your Model) -->
        <a-entity 
            gltf-model="https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models@master/2.0/BrainStem/glTF-Binary/BrainStem.glb" 
            position="0 0 -2"
            scale="0.5 0.5 0.5"
            rotation="0 180 0"
            gesture-handler>
        </a-entity>

    </a-scene>

    <script>
        // Camera permission handling
        function requestCameraAccess() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(function(stream) {
                        console.log("Camera access granted");
                    })
                    .catch(function(error) {
                        console.error("Camera access denied or error occurred: ", error);
                        alert("Please enable camera access for this site.");
                    });
            }
        }

        // Request camera access when page loads
        window.onload = function() {
            requestCameraAccess();
        }

        // Gesture control for rotation and zoom (Pinch-to-zoom and Rotate)
        AFRAME.registerComponent('gesture-handler', {
            init: function () {
                let el = this.el;
                let pinchStartDistance = null;
                let scale = 1;

                // Pinch zoom
                document.addEventListener('gesturestart', function (event) {
                    pinchStartDistance = event.scale;
                });

                document.addEventListener('gesturechange', function (event) {
                    if (pinchStartDistance) {
                        scale *= event.scale / pinchStartDistance;
                        pinchStartDistance = event.scale;
                        el.setAttribute('scale', `${scale} ${scale} ${scale}`);
                    }
                });

                // Rotate with two-finger touch
                let rotateStart = null;
                document.addEventListener('touchstart', function (event) {
                    if (event.touches.length === 2) {
                        rotateStart = event.touches;
                    }
                });

                document.addEventListener('touchmove', function (event) {
                    if (rotateStart && event.touches.length === 2) {
                        let dx = event.touches[0].clientX - event.touches[1].clientX;
                        let dy = event.touches[0].clientY - event.touches[1].clientY;
                        let angle = Math.atan2(dy, dx) * (180 / Math.PI);
                        el.setAttribute('rotation', `0 ${angle} 0`);
                    }
                });

                document.addEventListener('touchend', function () {
                    rotateStart = null;
                    pinchStartDistance = null;
                });
            }
        });
    </script>

</body>
</html>
